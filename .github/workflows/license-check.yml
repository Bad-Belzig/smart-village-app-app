name: License Check

on:
  push:
    branches:
      - master
    paths-ignore:
      - LICENSES.md
  pull_request:
    branches:
      - master

jobs:
  license_check:
    runs-on: ubuntu-latest

    permissions:
      # Give the default GITHUB_TOKEN write permission to commit and push the changed files back to the repository.
      contents: write

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.PAT_SVA_LICENSES }}

      - name: Install dependencies
        run: yarn install --frozen-lockfile

      - name: Generate license report as json
        run: node_modules/.bin/license-checker --json > licenses.json

      - name: Create LICENSES.md
        run: |
          echo "# License Report" > LICENSES.md
          echo "This file contains the licenses of the dependencies used in this project." >> LICENSES.md
          cat licenses.json >> LICENSES.md

      - uses: stefanzweifel/git-auto-commit-action@v5
        with:
          commit_message: Update LICENSES.md with latest dependencies information
